# Use the latest 2.1 version of CircleCI pipeline process engine.
version: 2.1
orbs:
  node: circleci/node@5.0.1
  aws-cli: circleci/aws-cli@2.1.0
  s3-cli: circleci/aws-s3@3.0.0
  ebs-cli: circleci/aws-elastic-beanstalk@2.0.1
# Define a job to be invoked later in a workflow.
jobs:
  say-done:
    # Specify the execution environment.
    docker:
      - image: cimg/base:stable
      - image: cimg/node:16.14.0
      - image: cimg/go:1.17
      - image: cimg/postgres:14.1.0-postgis
        auth:
              username: mydockerhub-user
              password: $DOCKERHUB_PASSWORD
            environment:
              POSTGRES_USER: udacity
              POSTGRES_DB: tech_store_test
              POSTGRES_PASSWORD: "123"
    # Add steps to the job
    steps:
      - node/install
      - checkout
      - run:
          name: Install Packages
          command: |
            npm install
      - run:
          name: Build and Complie
          command: |
            npm run build
      # - run:
      #     name: Lint
      #     command: |
      #       npm run lint
      # - run:
      #     name: Prettier
      #     command: |
      #       npm run prettier
      # - run:
      #     name: Build
      #     command: |
      #       npm run build
      - run:
          name: Test
          command: |
            npm test
      - run:
          name: Done
          command: echo "Job Done"

# Invoke jobs via workflows
workflows:
  project-workflow:
    jobs:
      - say-done
